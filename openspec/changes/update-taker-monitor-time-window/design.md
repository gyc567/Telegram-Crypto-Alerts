# åƒå•ç›‘æ§æ—¶é—´çª—å£å¯é…ç½®åŒ– - è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜åƒå•ç›‘æ§æ—¶é—´çª—å£ä»1åˆ†é’Ÿæ‰©å±•åˆ°1å°æ—¶å¹¶å®ç°å¯é…ç½®çš„å®æ–½æ–¹æ¡ˆã€‚

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **æ‰©å±•æ—¶é—´çª—å£**: ä»1åˆ†é’Ÿ â†’ 1å°æ—¶ (60åˆ†é’Ÿ)
2. **å¯é…ç½®åŒ–**: æ”¯æŒ1-1440åˆ†é’Ÿä»»æ„é…ç½®
3. **æ€§èƒ½ä¼˜åŒ–**: è‡ªé€‚åº”æ‰¹å¤„ç†å’Œå†…å­˜ç®¡ç†
4. **ç”¨æˆ·å‹å¥½**: Telegramå‘½ä»¤ç®¡ç†é…ç½®

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ç”¨æˆ·å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Telegram Bot                     â”‚  â”‚
â”‚  â”‚  - /taker_window set 60                  â”‚  â”‚
â”‚  â”‚  - /taker_window list                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                é…ç½®ç®¡ç†å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       TakerConfigManager                  â”‚  â”‚
â”‚  â”‚  - validate_window()                     â”‚  â”‚
â”‚  â”‚  - set_window_minutes()                  â”‚  â”‚
â”‚  â”‚  - get_window_options()                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                         â”‚           â”‚
â”‚           â–¼                         â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  config.py   â”‚         â”‚   .env      â”‚      â”‚
â”‚  â”‚  (é»˜è®¤é…ç½®)   â”‚         â”‚  (æŒä¹…åŒ–)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ä¸šåŠ¡é€»è¾‘å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        TimeWindowManager                  â”‚  â”‚
â”‚  â”‚  - update_window_size()                  â”‚  â”‚
â”‚  â”‚  - get_active_aggregator()               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                         â”‚
â”‚                       â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         OrderAggregator                   â”‚  â”‚
â”‚  â”‚  - è‡ªé€‚åº”æ‰¹å¤„ç†å¤§å°                       â”‚  â”‚
â”‚  â”‚  - æ™ºèƒ½æ¸…ç†é—´éš”                           â”‚  â”‚
â”‚  â”‚  - å†…å­˜ä¼˜åŒ–                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ•°æ®å­˜å‚¨å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          äº¤æ˜“æ•°æ®çª—å£                      â”‚  â”‚
â”‚  â”‚  - çƒ­æ•°æ®: æœ€è¿‘1å°æ—¶ (å†…å­˜)               â”‚  â”‚
â”‚  â”‚  - æ¸©æ•°æ®: 1-8å°æ—¶ (ç¼“å­˜)                â”‚  â”‚
â”‚  â”‚  - å†·æ•°æ®: 8-24å°æ—¶ (ç£ç›˜)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å…³é”®ç»„ä»¶

#### A. TakerConfigManager (é…ç½®ç®¡ç†å™¨)
```python
class TakerConfigManager:
    """åƒå•ç›‘æ§é…ç½®ç®¡ç†å™¨"""

    @staticmethod
    def get_window_minutes() -> int:
        """è·å–å½“å‰æ—¶é—´çª—å£"""
        return TAKER_CUMULATIVE_WINDOW_MINUTES

    @staticmethod
    def set_window_minutes(minutes: int, persist: bool = False) -> bool:
        """è®¾ç½®æ—¶é—´çª—å£"""
        if not TakerConfigManager.validate_window(minutes):
            return False

        # æ›´æ–°å†…å­˜ä¸­çš„é…ç½®
        import src.config as config
        config.TAKER_CUMULATIVE_WINDOW_MINUTES = minutes

        # æŒä¹…åŒ–åˆ°æ–‡ä»¶
        if persist:
            TakerConfigManager._persist_to_file(minutes)

        return True

    @staticmethod
    def validate_window(window_minutes: int) -> bool:
        """éªŒè¯æ—¶é—´çª—å£æ˜¯å¦åˆæ³•"""
        return TAKER_MIN_WINDOW_MINUTES <= window_minutes <= TAKER_MAX_WINDOW_MINUTES
```

#### B. TimeWindowManager (çª—å£ç®¡ç†å™¨)
```python
class TimeWindowManager:
    """æ—¶é—´çª—å£ç®¡ç†å™¨"""

    def __init__(self):
        self.windows: Dict[int, OrderAggregator] = {}
        self.active_window = self._load_configured_window()
        self._initialize_windows()

    def update_window_size(self, new_window_minutes: int) -> bool:
        """åŠ¨æ€æ›´æ–°æ—¶é—´çª—å£å¤§å°"""
        if not self._validate_window_size(new_window_minutes):
            return False

        old_window = self.active_window
        self.active_window = new_window_minutes

        # åˆ›å»ºæ–°çš„èšåˆå™¨
        self.windows[new_window_minutes] = OrderAggregator(
            window_minutes=new_window_minutes
        )

        # æ¸…ç†æ—§çš„çª—å£
        if old_window not in [5, 15, 60]:  # ä¿ç•™å¸¸ç”¨çª—å£
            del self.windows[old_window]

        return True
```

#### C. OrderAggregator (è®¢å•èšåˆå™¨)
```python
class OrderAggregator:
    """è®¢å•èšåˆå™¨ - æ”¯æŒåŠ¨æ€æ—¶é—´çª—å£"""

    def __init__(self, window_minutes: int = None):
        # åŠ¨æ€åŠ è½½é…ç½®
        if window_minutes is None:
            from src.config import TAKER_CUMULATIVE_WINDOW_MINUTES
            window_minutes = TAKER_CUMULATIVE_WINDOW_MINUTES

        self.window_minutes = window_minutes
        self.window_ms = window_minutes * 60 * 1000

        # è‡ªé€‚åº”é…ç½®
        self.batch_size = self._calculate_batch_size()
        self.cleanup_interval = self._get_cleanup_interval()

    def _calculate_batch_size(self) -> int:
        """æ ¹æ®æ—¶é—´çª—å£å¤§å°åŠ¨æ€è®¡ç®—æ‰¹å¤„ç†å¤§å°"""
        if self.window_minutes >= 240:  # 4å°æ—¶ä»¥ä¸Š
            return 10000
        elif self.window_minutes >= 60:  # 1å°æ—¶ä»¥ä¸Š
            return 5000
        elif self.window_minutes >= 15:  # 15åˆ†é’Ÿä»¥ä¸Š
            return 2000
        else:  # 15åˆ†é’Ÿä»¥ä¸‹
            return 1000
```

---

## ğŸ“Š æ•°æ®æµè®¾è®¡

### 1. é…ç½®æ›´æ–°æµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â†“
/taker_window set 60
    â†“
Telegramå‘½ä»¤å¤„ç†å™¨
    â†“
TakerConfigManager.validate_window(60)
    â†“
TakerConfigManager.set_window_minutes(60, persist=True)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ›´æ–°å†…å­˜    â”‚  æŒä¹…åŒ–åˆ°æ–‡ä»¶ â”‚
â”‚  é…ç½®       â”‚  é…ç½®        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚
       â–¼              â–¼
  OrderAggregator  TimeWindowManager
  é‡æ–°åˆ›å»º         æ›´æ–°æ´»è·ƒçª—å£
       â”‚              â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
         æ–°é…ç½®ç”Ÿæ•ˆ
```

### 2. äº¤æ˜“å¤„ç†æµç¨‹

```
äº¤æ˜“æ•°æ®è¿›å…¥
    â†“
TimeWindowManager.get_active_aggregator()
    â†“
OrderAggregator.add_trade(trade)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ·»åŠ åˆ°å¯¹åº”äº¤æ˜“å¯¹çª—å£              â”‚
â”‚  2. æ£€æŸ¥å•ç¬”è®¢å•é˜ˆå€¼                  â”‚
â”‚  3. æ›´æ–°ç´¯ç§¯ç»Ÿè®¡                      â”‚
â”‚  4. æ£€æŸ¥çª—å£æº¢å‡º                     â”‚
â”‚  5. è§¦å‘å‘Šè­¦ (å¦‚æœéœ€è¦)              â”‚
â”‚  6. æ‰¹å¤„ç†å’Œä¼˜åŒ–                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
    â†“
å†…å­˜ä½¿ç”¨ç›‘æ§
```

---

## ğŸ’¾ å­˜å‚¨è®¾è®¡

### 1. å†…å­˜ç»“æ„

```python
# äº¤æ˜“å¯¹ â†’ çª—å£æ¡ç›®é˜Ÿåˆ—
self.trade_windows: Dict[str, deque] = {
    "BTCUSDT": deque([
        WindowEntry(
            trade_event=TradeEvent(...),
            usd_value=100000.0,
            timestamp=2025-11-10 14:00:00,
            buy_volume=2.5,
            sell_volume=0
        ),
        ...
    ]),
    "ETHUSDT": deque([...])
}
```

### 2. åˆ†å±‚å­˜å‚¨ç­–ç•¥

| æ•°æ®ç±»å‹ | å­˜å‚¨ä½ç½® | ä¿ç•™æ—¶é—´ | è¯´æ˜ |
|----------|----------|----------|------|
| **çƒ­æ•°æ®** | å†…å­˜ (RAM) | æœ€è¿‘1å°æ—¶ | å®æ—¶è®¡ç®—å’ŒæŸ¥è¯¢ |
| **æ¸©æ•°æ®** | å†…å­˜ç¼“å­˜ | 1-8å°æ—¶ | ç»Ÿè®¡åˆ†æ |
| **å†·æ•°æ®** | ç£ç›˜æ–‡ä»¶ | 8-24å°æ—¶ | å†å²å½’æ¡£ |
| **å½’æ¡£æ•°æ®** | å‹ç¼©æ–‡ä»¶ | >24å°æ—¶ | é•¿æœŸä¿å­˜ |

---

## âš¡ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. æ‰¹å¤„ç†ä¼˜åŒ–

```python
def process_trades_batch(self, trades: List[TradeEvent]):
    """æ‰¹é‡å¤„ç†äº¤æ˜“æ•°æ®"""

    # 1. æŒ‰äº¤æ˜“å¯¹åˆ†ç»„
    grouped_trades = self._group_by_symbol(trades)

    # 2. æ‰¹é‡å¤„ç†æ¯ä¸ªäº¤æ˜“å¯¹
    for symbol, symbol_trades in grouped_trades.items():
        # 2.1 æ‰¹é‡æ·»åŠ 
        self._add_trades_batch(symbol, symbol_trades)

        # 2.2 æ‰¹é‡æ£€æŸ¥é˜ˆå€¼
        if self._check_threshold_batch(symbol):
            # 2.3 è§¦å‘å‘Šè­¦
            self._trigger_alert_batch(symbol)

    # 3. æ‰¹é‡æ¸…ç†
    self._cleanup_batch()

    # 4. æ›´æ–°ç»Ÿè®¡
    self._update_stats_batch()
```

### 2. å†…å­˜ç®¡ç†

```python
def cleanup_expired(self):
    """æ™ºèƒ½æ¸…ç†è¿‡æœŸæ•°æ®"""

    current_time = time.time() * 1000
    cutoff_time = current_time - (self.window_ms * 2)  # ä¿ç•™2ä¸ªçª—å£

    for symbol in list(self.trade_windows.keys()):
        window = self.trade_windows[symbol]

        # å¢é‡æ¸…ç†
        while window and window[0].timestamp < cutoff_time:
            window.popleft()

        # é‡Šæ”¾ç©ºçª—å£
        if not window:
            del self.trade_windows[symbol]

    # å†…å­˜å‹åŠ›æ£€æµ‹
    if self._check_memory_pressure():
        self._aggressive_cleanup()
```

---

## ğŸ” å®‰å…¨è®¾è®¡

### 1. è¾“å…¥éªŒè¯

```python
def validate_window_size(window: int) -> bool:
    """ä¸¥æ ¼éªŒè¯æ—¶é—´çª—å£å¤§å°"""

    # ç±»å‹æ£€æŸ¥
    if not isinstance(window, int):
        return False

    # èŒƒå›´æ£€æŸ¥
    if not (TAKER_MIN_WINDOW_MINUTES <= window <= TAKER_MAX_WINDOW_MINUTES):
        return False

    # ä¸šåŠ¡é€»è¾‘æ£€æŸ¥
    if window % 5 != 0:  # è¦æ±‚æ˜¯5çš„å€æ•°
        return False

    return True
```

### 2. æƒé™æ§åˆ¶

```python
@taker_message_handler(commands=["taker_window"])
@self.is_admin  # ä»…ç®¡ç†å‘˜å¯æ‰§è¡Œ
def on_taker_window_config(message):
    """ç®¡ç†åƒå•ç›‘æ§æ—¶é—´çª—å£ - éœ€è¦ç®¡ç†å‘˜æƒé™"""
    # æƒé™æ£€æŸ¥å·²åœ¨è£…é¥°å™¨ä¸­å®Œæˆ
    # ä¸šåŠ¡é€»è¾‘å¤„ç†
    pass
```

### 3. æ“ä½œå®¡è®¡

```python
def set_window_minutes(minutes: int, persist: bool = False) -> bool:
    """è®¾ç½®æ—¶é—´çª—å£ - è®°å½•æ“ä½œæ—¥å¿—"""

    if not self.validate_window(minutes):
        logger.error(f"Invalid window size attempted: {minutes}")
        return False

    # è®°å½•æ“ä½œå®¡è®¡æ—¥å¿—
    logger.info(
        f"Taker window change: "
        f"user={message.from_user.id}, "
        f"old={self.get_window_minutes()}, "
        f"new={minutes}, "
        f"persist={persist}"
    )

    # æ‰§è¡Œè®¾ç½®
    import src.config as config
    config.TAKER_CUMULATIVE_WINDOW_MINUTES = minutes

    if persist:
        self._persist_to_file(minutes)

    return True
```

---

## ğŸ“ˆ ç›‘æ§è®¾è®¡

### 1. å…³é”®æŒ‡æ ‡

```python
class TakerMetrics:
    """åƒå•ç›‘æ§æŒ‡æ ‡"""

    def __init__(self):
        self.metrics = {
            # é…ç½®æŒ‡æ ‡
            "window_size_minutes": 0,
            "window_size_bytes": 0,

            # æ€§èƒ½æŒ‡æ ‡
            "trade_count_total": 0,
            "trade_count_per_minute": 0,
            "window_hits_total": 0,
            "window_hit_rate": 0.0,

            # å†…å­˜æŒ‡æ ‡
            "memory_usage_mb": 0,
            "memory_usage_trend": [],

            # å¤„ç†æ€§èƒ½
            "batch_processing_time_avg": 0,
            "batch_processing_time_max": 0,
            "cleanup_operations": 0,

            # é”™è¯¯æŒ‡æ ‡
            "errors_total": 0,
            "errors_by_type": defaultdict(int)
        }
```

### 2. å‘Šè­¦è§„åˆ™

```python
ALERT_RULES = {
    "memory_high": {
        "condition": "memory_usage_mb > 1000",
        "severity": "warning",
        "message": "åƒå•ç›‘æ§å†…å­˜ä½¿ç”¨è¿‡é«˜: {memory_usage_mb}MB",
        "cooldown": 300  # 5åˆ†é’Ÿ
    },

    "hit_rate_high": {
        "condition": "window_hit_rate > 0.1",
        "severity": "warning",
        "message": "åƒå•çª—å£æº¢å‡ºç‡è¿‡é«˜: {window_hit_rate:.2%}",
        "cooldown": 300
    },

    "processing_slow": {
        "condition": "batch_processing_time_avg > 5000",
        "severity": "warning",
        "message": "åƒå•æ‰¹å¤„ç†è€—æ—¶è¿‡é•¿: {batch_processing_time_avg}ms",
        "cooldown": 300
    }
}
```

---

## ğŸ§ª æµ‹è¯•è®¾è®¡

### 1. æµ‹è¯•ç­–ç•¥

```
å•å…ƒæµ‹è¯• (90%è¦†ç›–ç‡)
    â”‚
    â”œâ”€â”€ é…ç½®æµ‹è¯•
    â”‚   â”œâ”€â”€ test_config_loading()
    â”‚   â”œâ”€â”€ test_config_validation()
    â”‚   â””â”€â”€ test_config_update()
    â”‚
    â”œâ”€â”€ ç»„ä»¶æµ‹è¯•
    â”‚   â”œâ”€â”€ test_order_aggregator()
    â”‚   â”œâ”€â”€ test_time_window_manager()
    â”‚   â””â”€â”€ test_taker_config_manager()
    â”‚
    â””â”€â”€ å‘½ä»¤æµ‹è¯•
        â”œâ”€â”€ test_taker_window_command()
        â”œâ”€â”€ test_set_window_command()
        â””â”€â”€ test_list_window_command()

é›†æˆæµ‹è¯•
    â”‚
    â”œâ”€â”€ test_end_to_end_window_update()
    â”œâ”€â”€ test_memory_usage_1_hour()
    â””â”€â”€ test_performance_batch_processing()

æ€§èƒ½æµ‹è¯•
    â”‚
    â”œâ”€â”€ test_memory_benchmark()
    â”œâ”€â”€ test_cpu_benchmark()
    â”œâ”€â”€ test_throughput_benchmark()
    â””â”€â”€ test_long_running_stability()
```

### 2. åŸºå‡†æµ‹è¯•

```python
def test_memory_benchmark():
    """å†…å­˜ä½¿ç”¨åŸºå‡†æµ‹è¯•"""

    # æµ‹è¯•ä¸åŒæ—¶é—´çª—å£çš„å†…å­˜ä½¿ç”¨
    test_cases = [
        (60, 60000, 300),    # 1å°æ—¶çª—å£, 6ä¸‡ç¬”äº¤æ˜“
        (240, 240000, 1200), # 4å°æ—¶çª—å£, 24ä¸‡ç¬”äº¤æ˜“
    ]

    for window_minutes, trade_count, expected_memory_mb in test_cases:
        # åˆ›å»ºèšåˆå™¨
        aggregator = OrderAggregator(window_minutes=window_minutes)

        # æ¨¡æ‹Ÿäº¤æ˜“
        for i in range(trade_count):
            trade = create_test_trade()
            aggregator.add_trade(trade)

        # æµ‹é‡å†…å­˜
        actual_memory_mb = measure_memory_usage(aggregator)

        # éªŒè¯
        assert actual_memory_mb <= expected_memory_mb * 1.2, \
            f"å†…å­˜ä½¿ç”¨è¶…æ ‡: {actual_memory_mb}MB > {expected_memory_mb}MB"
```

---

## ğŸ”„ éƒ¨ç½²è®¾è®¡

### 1. ç°åº¦éƒ¨ç½²ç­–ç•¥

```
é˜¶æ®µ1: å¼€å‘ç¯å¢ƒ (Day 1-2)
    â†“
é˜¶æ®µ2: æµ‹è¯•ç¯å¢ƒ (Day 3-4)
    â†“
é˜¶æ®µ3: é¢„ç”Ÿäº§ç¯å¢ƒ (Day 5)
    â†“
é˜¶æ®µ4: ç”Ÿäº§ç¯å¢ƒç°åº¦ (Day 6)
    â”œâ”€â”€ 10% ç”¨æˆ·
    â”œâ”€â”€ 50% ç”¨æˆ·
    â””â”€â”€ 100% ç”¨æˆ·
    â†“
é˜¶æ®µ5: ç›‘æ§å’Œä¼˜åŒ– (Day 7)
```

### 2. å›æ»šç­–ç•¥

```python
# å›æ»šè„šæœ¬ç¤ºä¾‹
#!/bin/bash

echo "å¼€å§‹å›æ»šåƒå•ç›‘æ§æ—¶é—´çª—å£é…ç½®..."

# 1. åœæ­¢æœåŠ¡
sudo systemctl stop telegram-bot

# 2. æ¢å¤é…ç½®æ–‡ä»¶
cp /backup/config.py.backup /path/to/src/config.py

# 3. æ¸…ç†ç¼“å­˜
rm -rf /var/cache/taker_monitor/*

# 4. é‡å¯æœåŠ¡
sudo systemctl start telegram-bot

# 5. éªŒè¯æœåŠ¡
curl -f http://localhost:8080/health || exit 1

echo "å›æ»šå®Œæˆ"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **OpenSpec ææ¡ˆ**: [proposal.md](proposal.md)
- **ä»»åŠ¡æ¸…å•**: [tasks.md](tasks.md)
- **æŠ€æœ¯è§„æ ¼**: [specs/enhancement/spec.md](specs/enhancement/spec.md)
- **æ€§èƒ½ä¼˜åŒ–**: [docs/performance-optimization.md](docs/performance-optimization.md)
- **ç›‘æ§æŒ‡å—**: [docs/monitoring.md](docs/monitoring.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-11-10
**ä½œè€…**: OpenSpec AIåŠ©æ‰‹
